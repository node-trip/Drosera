# Установщик и Менеджер Ноды Drosera (SystemD)

Этот скрипт автоматизирует установку, настройку и управление нодой Drosera Operator для тестнета Holesky, используя **SystemD** для управления службой.

## Возможности

*   **Автоматическая установка:** Устанавливает все необходимые зависимости (`curl`, `git`, `build-essential`, `ufw`, `jq`, `unzip` и т.д.), CLI (`drosera`, `foundry`, `bun`) и настраивает firewall (`ufw`).
*   **Настройка Trap:** Инициализирует, компилирует, развертывает ваш Trap контракт и добавляет вашего оператора в whitelist.
*   **Настройка Operator:** Устанавливает бинарный файл Operator CLI, регистрирует оператора в сети Drosera.
*   **Настройка SystemD:** Создает и настраивает файл службы `/etc/systemd/system/drosera.service` для автоматического запуска и перезапуска оператора. Использует файл окружения `/root/.drosera_operator.env` для хранения ключа, IP и RPC.
*   **Настройка Firewall:** Добавляет правила в `ufw` для разрешения входящих соединений на порты 22 (SSH), 31313 (Drosera P2P) и 31314 (Drosera Server).
*   **Интерактивное меню:** Предоставляет удобное меню для управления нодой после установки:
    *   Полная установка/переустановка.
    *   Просмотр статуса службы и последних логов.
    *   Запуск, остановка службы оператора.
    *   Создание резервных копий конфигурации и данных (включая приватный ключ!).
    *   Выдача резервной копии по временной ссылке Cloudflared.
*   **Гибкость:**
    *   Запрашивает необходимые данные (ключ, адреса, email/username GitHub, RPC URL) интерактивно.

## Требования

*   Сервер под управлением Ubuntu 22.04 или новее (рекомендуется).
*   Минимум 2 CPU, 4GB RAM, 40GB SSD.
*   Права `sudo` (скрипт нужно запускать с `sudo`).
*   **Holesky ETH** на вашем кошельке оператора для развертывания Trap и отправки Bloom Boost.
*   **Собственный RPC URL** для сети Holesky от провайдера типа Alchemy, Infura и т.д. (Критически важно для стабильной работы!).

## Быстрый старт (Первая установка)

1.  **Подключитесь к вашему серверу** по SSH.
2.  **Загрузите и запустите скрипт** одной командой (она скачает скрипт, сделает его исполняемым и запустит с `sudo`):

    ```bash
    rm -f dro.sh && wget -O dro.sh --no-cache https://raw.githubusercontent.com/node-trip/Drosera/refs/heads/main/dro.sh && chmod +x dro.sh && sudo bash dro.sh
    ```

3.  **Выберите опцию `1`** в главном меню для запуска установки.
4.  **Введите запрашиваемые данные:**
    *   Ваш Email и Username от GitHub (для настройки git).
    *   Ваш **приватный ключ** от кошелька оператора (**без** `0x`). *Ввод будет скрыт.*
    *   Ваш **публичный адрес** этого же кошелька оператора (для Whitelist, **с** `0x`).
    *   Публичный **IP-адрес** вашего сервера.
    *   Ваш **Holesky RPC URL**.
5.  **Подтвердите введенные данные** и дождитесь завершения установки. Скрипт выполнит все шаги: установит зависимости, CLIs, настроит и развернет Trap, установит и зарегистрирует Operator, настроит службу SystemD и firewall, и запустит оператора.
6.  **❗ Обязательно после установки:**
    *   Убедитесь, что в конце вывода скрипта служба `drosera.service` имеет статус `active (running)`.
    *   Перейдите в дашборд Drosera: [https://app.drosera.io/](https://app.drosera.io/)
    *   Подключите свой **кошелек оператора**.
    *   Найдите свой Trap в разделе "Traps Owned" (адрес будет показан в конце вывода скрипта).
    *   На странице вашего Trap нажмите кнопку **[Send Bloom Boost]** и пополните баланс Trap, отправив немного Holesky ETH.
    *   На странице вашего Trap нажмите кнопку **[Opt In]**.
    *   Подождите 5-15 минут и обновите дашборд. Шкала статуса вашего оператора должна стать **зеленой**. Проверьте логи оператора через меню скрипта (опция 2), чтобы убедиться, что нет постоянных ошибок (сообщения `WARN ... InsufficientPeers` в начале - это нормально и должны постепенно исчезнуть).

## Управление Нодой

После установки используйте меню скрипта (`sudo bash dro.sh`) для управления вашей нодой:

*   **Опция 2:** Показать статус службы `drosera.service` и последние 15 строк лога.
*   **Опция 3:** Запустить службу `drosera.service`.
*   **Опция 4:** Остановить службу `drosera.service`.
*   **Опция 5:** Создать резервную копию данных ноды (`~/my-drosera-trap`, `/root/.drosera_operator.env`, `/etc/systemd/system/drosera.service`, бинарник оператора) в виде `.tar.gz` архива в домашней директории (`/root/` или `$HOME`, если запускаете не от root). **ВНИМАНИЕ: Архив содержит приватный ключ!** Храните его безопасно.
*   **Опция 6:** Создать резервную копию и предоставить временную ссылку для скачивания через Cloudflared.
*   **Опция 7:** Восстановление из бэкапа (пока не реализовано).

**Примечание:** Этот скрипт использует **SystemD** для управления процессом оператора, а не Docker.
